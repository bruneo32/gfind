name: Create debian package

env:
  DPKG: ${{github.event.repository.name}}_${{github.sha}}-${{github.run_number}}
  DPKG_NAME: "${{github.event.repository.name}}.deb"

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Create package structure
        run: |
          mkdir $DPKG
          cd $DPKG
          mkdir -p DEBIAN usr/local/bin usr/local/share/gfind

      - name: Copy stuff inside
        run: |
          cp deb_control $DPKG/DEBIAN/control
          cp gfind $DPKG/usr/local/bin/gfind
          chmod +x $DPKG/usr/local/bin/*
          cp -r share/* $DPKG/usr/local/share/gfind/
          cp LICENSE $DPKG/usr/local/share/gfind/
          cp README.md $DPKG/usr/local/share/gfind/

      - name: Create deb package
        run: |
          dpkg-deb -Zxz --root-owner-group --build $DPKG $DPKG_NAME
          echo "DPKG_NAME=$(dpkg-name -o $DPKG_NAME)" >> $GITHUB_ENV

      - name: Upload deb as artifact
        uses: actions/upload-artifact@v3
        with:
          name: $DPKG_NAME
          path: $DPKG_NAME
